#!/bin/sh

<%- if node[:letsencrypt][:webroot_mode] %>
  <%- mode = "--webroot -w #{node[:letsencrypt][:webroot_path]}"%>
<%- else %>
  <%- mode = "--standalone --http-01-address #{node[:letsencrypt][:standalone_host]} --http-01-port #{node[:letsencrypt][:standalone_port]}"%>
<%- end %>

certbot certonly \
  --config-dir <%= node[:letsencrypt][:config_dir] %> \
  --cert-name <%= node[:letsencrypt][:cert_name] %> \
  --noninteractive \
  --agree-tos \
  --email <%= @email %> \
  --no-eff-email \
  <%= mode %> \
  -d <%= @ssl_domains.join(",") %>
